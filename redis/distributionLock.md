## 分布式锁

**分布式锁的实现方式**：

+ <a href="#dbLock">数据库乐观锁</a>
+ <a href="#redisLock">基于**Redis**的分布式锁</a>


----

### <a name="redisLock">基于**Redis**的分布式锁</a>

为确保分布式锁的可用，需同时满足以下4个条件：

+ **互斥性** ——任一时刻只有一个客户端能持有锁
+ **不会发生死锁** —— 有一个客户端在持有锁期间崩溃没有主动解锁也能保证后续其它客户端能加锁
+ **容错性** —— 只要大部分`redis`节点正常运行，客户端就可以加锁和解锁
+ 加锁和解锁必须是同一个客户端，客户端不能解别的客户端的锁






----

<a name="dbLock">数据库乐观锁</a>

在数据库中，`lock`和`latch`都可以称为锁，`latch`一般称为门闩（**轻量级的锁**）

+ 在`InnoDB`存储引擎中`latch`分为**互斥锁**(mutex)和**读写锁**(rwlock)，目的是用来保证并发线程操作的正确性
+ `lock`的对象是事务，用来锁定数据库中的对象，如**表、页、行**，并且一般锁的对象仅在事务`commit`或`rollback`后释放





|      |                  lock                  |               latch               |
| :--: | :------------------------------------: | :-------------------------------: |
|  对象  |                   事务                   |                线程                 |
|  保护  |                 数据库内容                  |              内存数据结构               |
| 持续时间 |                 整个事务过程                 |               临界资源                |
|  模式  |               行锁、表锁、意向锁                |              读写锁、互斥量              |
|  死锁  | 通过`waits-for graph、timeout`机制进行死锁检测与处理 | 无死锁检测和处理机制，仅通过应用程序的加锁顺序保证无死锁的情况发生 |



<a href="">`InnoDB存储引擎中的锁`</a>