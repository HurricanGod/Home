[TOC]

微处理器即CPU，是微型计算机的核心部件，CPU由如下3部分组成：

1. 算术逻辑部件
2. 累加器和寄存器组
3. 控制器

微型计算机，由CPU、存储器(ROM,RAM)、输入/输出接口和系统总线构成

微型计算机系统，以微型计算机为主体，配上系统软件、应用软件和外设之后就成了微型计算机系统。



微型计算机的性能：

- CPU的位数
- CPU的主频
- 内存容量和速度
- 硬盘容量

####  8086编程结构

1. 总线接口部件(BIU)

2. 执行部件(EU)

   	总线接口部件(BIU)的功能是负责与存储器、I/O端口传输数据
   	执行部件(EU)的功能是负责执行指令



8086中一个最基本的总线周期由**4个时钟周期**组成，**时钟周期**是CPU的基本时间计量单位

----

##### 8086工作模式

最小模式：系统中只有8086一个微处理器，所有的总线控制信号都由8086产生。

最大模式：包括两个或者微处理器。



中断向量表中每个中断占4个字节存储单元，前两个单元存放中断处理子程序的入口地址的偏移量**IP**，低位在前，高位在后，后两个单元存放中断处理子程序入口地址的段地址**CS**.

常量中断类型号：

1. 除数为0中断：0H
2. 单步中断：1H
3. 非屏蔽中断：2H
4. 断点中断：3H
5. 溢出中断：4H



8086一旦让出总线控制权，便使地址/数据引脚、地址/状态引脚以及控制信号引脚RD、WR、INTA、M/IO、DEN及DT/R都处于浮空状态。CPU和数据总线、地址总线及控制信号之间没有联系。

------

##### 8086存储器编址和I/O编址

8086的I/O编址：允许64K个8位的I/O端口，两个相邻的I/O端口可以组合成一个16位的端口，**8086采用I/O端口独立编址的方式**

​						**标志寄存器**

<table>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>OF</td>
<td>DF</td>
<td>IF</td>
<td>TF</td>
<td>SF</td>
<td>ZF</td>
<td></td>
<td>AF</td>
<td></td>
<td>PF</td>
<td></td>
<td>CF</td>
</tr>
</table>

状态标志位：SF、ZF、PF、CF、AF、OF

控制标志位：DF、IF、TF

iret指令的功能为：

1. pop IP
2. pop CS
3. popf   



汇编指令：sti(置中断允许为)、cli(清中断允许位)



##### 存储器

易失性存储器是指断电后，存储器内容是否丢失，外部存储器一般都是非易失性的，ROM也是非易失性的。

片选信号的产生方法：

1. 线选法
2. 全译码法
3. 部分译码法
4. 混合译码法

##### 接口

微型计算机接口技术的定义：

1. 处理微机系统与外设间联系的技术
2. 注意其软硬结合的特点
3. 根据应用系统的需要，使用和构造相应的接口电路，编制配套的接口程序，支持和连接有关的设备



对于输入设备来说，接口通常起信号转换和缓冲作用，对于输出设备来说，接口将CPU送来的并行数据放在缓冲器中，并将它变成外设所需要的信息形式。

接口部件包含一组寄存器（数据输入寄存器、数据输出寄存器、控制寄存器1、状态寄存器）

接口与系统的连接：

- 和I/O设备连接
- 和系统总线相连

----

CPU与输入/输出设备之间的信号分为：

1. 数据信息
2. 状态信息
3. 控制信息

CPU和外设进行数据传输时，各类信息在接口中进入不同的寄存器，一般称为这些寄存器为I/O端口，每个端口有端口地址。



**CPU和外设的数据传输方式：**

- 程序方式（程序控制下进行的信息传送）
  - 无条件传送方式（不用查询外设的状态）
  - 条件传送方式（查询方式传送，读取并测试外设状态）
- 中断方式
- DMA方式

在查询方式下CPU不断读取状态字和检测状态字，如状态字表明外设未准备好，CPU须等待。

中断传送方式的优点：提高CPU的效率和系统的实时性

中断传送方式的缺点：每进入1次中断方式程序需要保存断点和标志位，中断结束后又要恢复现场，这需要花费CPU不少时间，此外每次进入中断，指令缓冲队列要被清除，需要重新装入指令才能执行；中断是按照字节或字传输的，不适合块的传输。



按照数据传输时发送过程和接收过程的关系划分，串行通信分为：

+ 全双工方式
+ 半双工方式
+ 单工方式

位传输的速率称为波特率.

-------

#### 8251

8251有一奇一偶两个端口地址，偶端口地址对应数据输入寄存器和数据输出寄存器，

奇地址端口对应状态寄存器、模式寄存器、控制寄存器和同步字符寄存器。



**模式寄存器**

| 停止位          | 校验类型 | 校验允许位 | 数据位  | 模式选择        |
| :----------- | :--- | :---- | :--- | :---------- |
| 0/1：2/1个同步字符 | 0：奇  | 0：无   | 00：5 | 00：同步模式     |
| 01：1位        | 1：偶  | 1：有   | 01：6 | 01：波特率因子为1  |
| 10：1.5位      |      |       | 10：7 | 10：波特率因子为16 |
| 11 ：2位       |      |       | 11：8 | 11：波特率因子为64 |

**状态寄存器**

| DSR  | SYN  | FE   | OE   | PE   | TxE  | RxRDY |  TxRDY  |
| :--: | ---- | ---- | ---- | ---- | :--: | :---: | :-----: |
|  ✔   |      |      |      |      |  ✔   |   ✔   |    ✔    |
|      |      |      |      |      |      |       | 发送缓冲区为空 |



**控制寄存器**

|  EH  |  IR  | RTS  | ER   | SBRK | RxE  | DTR  | TxEN |
| :--: | :--: | ---- | ---- | ---- | :--: | :--: | :--: |
|      |  ✔   |      |      |      |  ✔   |      |  ✔   |
|      |      |      |      |      | 接收允许 |      | 发送允许 |

----

##### 8255

**方式选择控制字**

|     1      | D6 D5  |       D4        |        D3         |   D2   |       D1       |        D0         |
| :--------: | :----: | :-------------: | :---------------: | :----: | :------------: | :---------------: |
| 方式选择控制字标志位 | A组方式选择 | 端口A    1：输入0：输出 | PC7~PC4 1：输入 0：输出 | B组方式选择 | 端口B   1：输入0：输出 | PC3~PC0 1：输入 0：输出 |

|  端口  |     是否锁存      | 地址(A1,A0) |
| :--: | :-----------: | :-------: |
|  A   |    输入输出锁存     |    00     |
|  B   |  输出锁存，输入不锁存   |    01     |
|  C   |  输出锁存，输入不锁存   |    10     |
| 控制口  | ------------- |    11     |

----

| 工作方式 |    名称     |   端口    |
| :--: | :-------: | :-----: |
| 方式0  | 基本输入/输出方式 | 端口A、端口B |
| 方式1  | 选通输入/输出方式 | 端口A、端口B |
| 方式2  |  双向传输方式   |   端口A   |

|  端口  | 工作方式  | 选通信号!STB | 缓冲器满信号IBF | 中断请求信号  |
| :--: | :---: | :------: | :-------: | :-----: |
|  A   | 方式1输入 | PC4(输入)  |  PC5(输出)  | PC3(输出) |
|  B   | 方式1输入 | PC2(输入)  |  PC1(输出   | PC0(输出) |



|  端口  | 工作方式  | 响应信号!ACK | 缓冲器满信号!OBF | 中断请求信号  |
| :--: | :---: | :------: | :--------: | :-----: |
|  A   | 方式1输出 | PC6(输入)  |  PC7(输出)   | PC3(输出) |
|  B   | 方式1输出 | PC2(输入)  |  PC1(输出)   | PC0(输出) |



##### 中断控制器

**8259的工作方式**

- 全嵌套方式
- 特殊全嵌套方式（一般用于8259A级联系统中）
- 优先级自动循环
- 优先级特殊循环

**屏蔽中断源的方式**

+ 普通屏蔽方式
+ 特殊屏蔽方式



**8259A中断结束方式**

+ 中断自动结束（只能用于1片8259A且中断无不会嵌套，第2个中断响应负脉冲到来时将ISR相应为**复位**）
+ 一般的中断结束方式（用于全嵌套方式，把ISR中最高非零IS位**复位**）
+ 特殊的中断结束方式（需要对主片和从片发中断结束命令）

---

**初始化命令字**

| 初始化命令字 | 写入端口 |
| :----: | :--: |
|  ICW1  | 偶地址  |
|  ICW2  | 奇地址  |
|  ICW3  | 奇地址  |
|  ICW4  | 奇地址  |





**ICW1**

| D7~D5 |    1    |      LTIM       | ADI  |    SNGL     |     IC4     |
| :---: | :-----: | :-------------: | :--: | :---------: | :---------: |
|   X   | ICW1标志位 | 0：边沿触发   1：电平触发 |  X   | 1：不级联0：多片级联 | 1：指示要设置ICW4 |



**ICW2**

中断类型号的高五位就是ICW2的高五位，低三位由引入中断引脚决定

**ICW3**

标志主片/从片的初始化命令字，若为主片，D7~D0对应本片的IR7~IR0引脚的连接情况，有连接从片对应位为1；若为从片，则高五位为0，低三位为本片标志码。

**级联方式时主片、从片都必须设置。**

**ICW4**

16位以上的系统必须设置

|  D7~D5  |  SFNM   |  BUF   |      M/!S      |   AEOI   |  PM   |
| :-----: | :-----: | :----: | :------------: | :------: | :---: |
| ICW4标识码 | 1：特殊全嵌套 | 1：缓冲方式 | BUF=1&1表示本片为主片 | 1：中断自动结束 | 非8位系统 |

---

**操作命令字**

| 操作命令字 | 写入地址 |
| :---: | :--: |
| OCW1  | 奇地址  |
| OCW2  | 偶地址  |
| OCW3  | 偶地址  |



**OCW1**中断屏蔽操作字，某位为1表示该位被屏蔽

**OCW2**设置优先级循环方式和中断结束方式的操作命令字.

|        R         |      SL       |   EOI   |   D4~D3    |    L2~L0     |
| :--------------: | :-----------: | :-----: | :--------: | :----------: |
| 1：优先级循环方式0：非循环方式 | 1：决定D2~D0是否有效 | 中断结束命令位 | 00为OCW2标志码 | 指出要清除的ISR相应位 |

EOI为0，OCW2用于指定优先级循环方式的命令字；EOI为1，OCW2用作中断结束命令，同时使系统按照一定方式继续工作

----

##### DMA控制器

DMA初始化过程：

1. 将数据传送缓存区的起始地址或结束地址送到**地址寄存器**中
2. 将传输的字节数、字数或双字数送到**计数器**中

DMA控制系统总线时称为主模块，当DMA接收CPU读/写操作时为从模块。



**工作模式**

1. 单字节传输
2. 块传输
3. 请求传输
4. 级联传输

**模式寄存器**

| D7~D6    | D5     | D4    | D3~D2   | D1~D0  |
| :------- | :----- | :---- | :------ | :----- |
| 00：请求传输  | 1：地址递减 | 自动初始化 | 00：校验传输 | 00：通道0 |
| 01：单字节传输 | 0：地址递增 |       | 01：写传输  | 01：通道1 |
| 10：块传输   |        |       | 10：读传输  | 10：通道2 |
| 11：级联传输  |        |       |         | 11：通道3 |

**进行1次DMA传输，普通时序下需要3个时钟周期，压缩时序下需要2个时钟周期**

***内存到内存的传输需要两个总线周期***

**控制寄存器**

|      |    D7     |    D6     |   D5   |  D4   |  D3  |   D2   |  D1  |      D0      |
| :--: | :-------: | :-------: | :----: | :---: | :--: | :----: | :--: | :----------: |
|  0   | DACK低电平有效 | DREQ高电平有效 | 不扩展写信号 | 固定优先级 | 普通时序 | 启动8237 |      | 允许存储器到存储器的传输 |
|  1   |           |           |        | 循环优先级 | 压缩时序 | 停止8237 |      |              |



##### 计数器

计数器/定时器含有的4个寄存器：

+ 初值寄存器（CPU可写）
+ 计数输出寄存器（CPU可读）
+ 控制寄存器（CPU可读）
+ 状态寄存器（CPU可写）

**8253/8254**有4个端口地址，

| A1A0 |   端口    |
| :--: | :-----: |
|  00  |  计数器0   |
|  01  |  计数器1   |
|  10  |  计数器2   |
|  11  | 控制口和状态口 |



**模式设置控制字**

|      | SC1 SC0 | RW1 RW0         | M2~M0 | BCD             |
| :--: | :------ | :-------------- | :---- | :-------------- |
| 000  | 选计数器0   | 对计数器进行锁存        | 模式0   | 后面设置的计数器初值为二进制  |
| 001  | 选计数器1   | 只读/写低8位         | 模式1   | 后面设置的计数器初值为BCD码 |
| 010  | 选计数器2   | 只读/写高8位         | 模式2   |                 |
| 011  | 读控制字标志码 | 先读/写低8位,后读/写高8位 | 模式3   |                 |
| 100  |         |                 | 模式4   |                 |
| 101  |         |                 | 模式5   |                 |



**8253/8254工作模式**

|  模式  |      特点      |    触发方式    |      |      波形       |
| :--: | :----------: | :--------: | :--: | :-----------: |
| 模式0  |   计数结束产生中断   |  （高）电平触发   | 计数器  |               |
| 模式1  |  可编程单稳态触发器   |   上升沿触发    | 计数器  |  N个时钟周期的负脉冲   |
| 模式2  |     分频器      | 电平触发、上升沿触发 | 定时器  | 负脉冲1个，正脉冲N-1个 |
| 模式3  |    方波发生器     | 电平触发、上升沿触发 | 定时器  |               |
| 模式4  | 软件触发的选通信号发生器 |  （高）电平触发   | 计数器  |               |
| 模式5  | 硬件触发的选通信号发生器 |   上升沿触发    | 计数器  |               |

