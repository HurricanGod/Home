## 查询优化

**查询性能低下的最基本原因就是访问了太多的数据**



MySql返回1行的访问类型有（出现在explain中的type列）：

1. 全表扫描
2. 索引扫描
3. 范围扫描
4. 唯一索引查找
5. 常量

```sql
 explain select * from testindex where id<3;
```

|  id  | select_type |   table   | partitions | type  | possible_keys |   key   | key_len | ref  | rows | filtered | Extra       |
| :--: | :---------: | :-------: | :--------: | :---: | :-----------: | :-----: | :-----: | :--: | :--: | :------: | ----------- |
|  1   |   SIMPLE    | testindex |    NULL    | range |    PRIMARY    | PRIMARY |    4    | NULL |  2   |  100.0   | Using where |



**MySql会在3中情况使用Where子句，效率依次降低：**

+ 对索引查找使用where子句来消除不匹配的行，发生在存储引擎层
+ 使用覆盖索引(Extra列是'using index')来避免访问行并且从索引取得数据后过滤掉不匹配的行，发生在服务器层，不需要从表中读取行
+ 从表中检索数据，然后过滤掉不匹配的行(Extra列是'using where')，发生在服务器端并且需要从表中读取行后再过滤掉

**MySql执行查询的一般性过程：**

+ 客户端将查询请求发送到服务器
+ 服务器检查查询缓存，如果找到了就从缓存中返回结果，否则进行下一步
+ 服务器解析，预处理和查询优化，生成执行计划
+ 执行引擎调用存储引擎API执行查询
+ 服务器将结果发送会客户端



解析：MySql解析器将查询分解成一个个标识，构造“解析树”，对sql语句进行语法分析

预处理：检查解析器生成的结果树，进行语义分析，语义分析完成后如果没有错误进行**权限检查**

查询优化：找到最优的查询执行方式

----

### MySql能够处理的优化类型

1. 将外连接转换成内连接
2. 代数等价法则
3. 优化count()、min()、max()
4. 计算和减少常量表达式
5. 覆盖索引
6. 子查询优化

------

### B+树索引存取方法的选择

1. 如果1个或1组属性经常在查询条件中出现，则考虑在这个属性或这组属性上建立索引
2. 经常作为聚集函数参数的1个或1组属性可以考虑建立索引
3. 经常作为连接操作的连接条件的属性可以建立索引



